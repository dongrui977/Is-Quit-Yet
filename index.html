<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¾äº†å—ï¼Ÿ- QuitYet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-black text-white flex flex-col items-center justify-center min-h-screen">
    <div class="text-center p-8">
        <h1 class="text-4xl font-black mb-10 tracking-tighter italic">è¾äº†å—?</h1>
        <div id="avatar" class="text-9xl mb-10 transition-all duration-500">ğŸ˜</div>
        <div id="status" class="text-zinc-500 mb-10 tracking-widest uppercase text-sm font-bold">åŒæ­¥ä¸­...</div>
        
        <div class="space-y-4">
            <button id="btn-checkin" onclick="checkIn()" class="w-full bg-white text-black px-10 py-5 rounded-2xl font-black text-xl active:scale-95 transition-all opacity-50 cursor-not-allowed" disabled>
                è¿˜æ²¡ï¼Œå†æ’‘ä¸€å¤© (<span id="count">0</span>)
            </button>
            <br>
            <button onclick="freedom()" class="text-zinc-700 text-xs underline uppercase tracking-widest mt-8 hover:text-red-500 transition-colors">
                [ æˆ‘è¦è§£è„± / ç¦»èŒ ]
            </button>
        </div>
    </div>

    <script>
        // âš ï¸ è¿™é‡Œå¡«å…¥ä½ åœ¨ Supabase Project Settings -> API é¡µé¢å¤åˆ¶çš„é’¥åŒ™
        const SUPABASE_URL = 'https://xptxthgckrnkptrukydd.supabase.co'; 
        const SUPABASE_KEY = 'keysb_publishable_yct5ZGnpmDhEPmSyg7zhaQ_yavnWjh8';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let days = 0;
        let quit = false;

        const av = document.getElementById('avatar');
        const st = document.getElementById('status');
        const co = document.getElementById('count');
        const btn = document.getElementById('btn-checkin');

        function updateUI() {
            co.innerText = days;
            if (quit) {
                av.innerText = "ğŸï¸";
                st.innerText = "çŠ¶æ€ï¼šå·²è§£è„± (è‡ªç”±ä¸‡å²)";
                st.className = "text-green-500 mb-10 tracking-widest uppercase text-sm font-bold";
                return;
            }
            if (days >= 30) av.innerText = "ğŸ—¿";
            else if (days >= 7) av.innerText = "ğŸ¤¡";
            else if (days >= 1) av.innerText = "ğŸ§Ÿ";
            st.innerText = quit ? "å·²è§£è„±" : "çŠ¶æ€ï¼šè‹Ÿæ´»ä¸­";
        }

        // åˆå§‹åŠ è½½
        async function loadData() {
            const { data, error } = await _supabase.from('status_logs').select().eq('id', 1).single();
            if (data) {
                days = data.days_count;
                quit = data.is_quit;
            } else {
                // å¦‚æœæ²¡æ•°æ®ï¼Œå…ˆåˆå§‹åŒ–ä¸€è¡Œ
                await _supabase.from('status_logs').insert({ id: 1, days_count: 0, is_quit: false });
            }
            updateUI();
            btn.disabled = false;
            btn.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        // æ‰“å¡é€»è¾‘
        async function checkIn() {
            if(quit) return;
            days++;
            updateUI();
            await _supabase.from('status_logs').update({ days_count: days }).eq('id', 1);
        }

        async function freedom() {
            if(confirm('çœŸçš„å†³å®šè§£è„±äº†å—ï¼Ÿ')) {
                quit = true;
                updateUI();
                await _supabase.from('status_logs').update({ is_quit: true }).eq('id', 1);
            }
        }

        loadData();
    </script>
</body>
</html>
