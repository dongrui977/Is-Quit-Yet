<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¾äº†å—ï¼Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-pop { animation: fade-in-up 0.4s ease-out; }
    </style>
</head>
<body class="bg-black text-white flex flex-col items-center justify-center min-h-screen overflow-hidden">
    <div class="text-center p-8 max-w-sm w-full">
        <h1 class="text-4xl font-black mb-10 tracking-tighter italic">è¾äº†å—ï¼Ÿ</h1>
        
        <div id="avatar" class="text-9xl mb-10 transition-all duration-500 hover:scale-110">ğŸ˜</div>
        
        <div id="status" class="text-zinc-500 mb-6 tracking-widest uppercase text-sm font-bold">
            æ­£åœ¨ç¡®è®¤ç”Ÿå‘½ä½“å¾...
        </div>

        <div id="quote" class="h-16 text-zinc-400 text-sm italic mb-10 px-4"></div>
        
        <div class="space-y-4">
            <button id="btn-checkin" onclick="checkIn()" class="w-full bg-white text-black px-10 py-5 rounded-2xl font-black text-xl active:scale-95 transition-all opacity-50 cursor-not-allowed" disabled>
                æ²¡å‘¢ï¼Œå†æ’‘ä¸€å¤© (<span id="count">0</span>)
            </button>
            <br>
            <button onclick="freedom()" class="text-zinc-700 text-xs underline uppercase tracking-widest mt-8 hover:text-red-500 transition-colors">
                [ æˆ‘è¦è§£è„± / ç¦»èŒ ]
            </button>
        </div>
    </div>

    <script>
        // âš ï¸ è®°å¾—å¡«å…¥ä½ è‡ªå·±çš„ Supabase é’¥åŒ™
        const SUPABASE_URL = 'https://xptxthgckrnkptrukydd.supabase.co'; 
        const SUPABASE_KEY = 'keysb_publishable_yct5ZGnpmDhEPmSyg7zhaQ_yavnWjh8';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let days = 0;
        let quit = false;

        const quotes = [
            "åªè¦ä½ è‚¯åŠªåŠ›ï¼Œä½ çš„è€æ¿æ˜å¹´å°±èƒ½æ¢æ³•æ‹‰åˆ©ã€‚",
            "å…¬å¸æ²¡äº†ä½ ç…§æ ·è½¬ï¼Œä½†æ²¡äº†ä½ è€æ¿çœŸçš„ä¼šå¼€å¿ƒã€‚",
            "å·¥ä½œä¸å…»é—²äººï¼Œä½†å…»æ‡’äººå’Œå·ç‹ã€‚",
            "ä¸–ä¸Šæ— éš¾äº‹ï¼Œåªè¦è‚¯æ”¾å¼ƒã€‚",
            "ä»Šå¤©ä¹Ÿæ˜¯è¢«è¿«è¥ä¸šçš„ä¸€å¤©ã€‚",
            "ä½ çš„å·¥èµ„ï¼Œå…¶å®æ˜¯å…¬å¸ç»™ä½ çš„ç²¾ç¥æŸå¤±è´¹ã€‚",
            "å¦‚æœä½ çš„å·¥ä½œè®©ä½ ä¸å¿«ä¹ï¼Œé‚£è¯´æ˜ä½ è¿˜æ²¡éº»æœ¨ã€‚"
        ];

        const av = document.getElementById('avatar');
        const st = document.getElementById('status');
        const co = document.getElementById('count');
        const btn = document.getElementById('btn-checkin');
        const quoteEl = document.getElementById('quote');

        function updateUI() {
            co.innerText = days;
            if (quit) {
                av.innerText = "ğŸï¸";
                st.innerText = "çŠ¶æ€ï¼šå·²è§£è„± (è‡ªç”±ä¸‡å²)";
                st.className = "text-green-500 mb-6 tracking-widest uppercase text-sm font-bold";
                quoteEl.innerText = "ä»æ­¤å±±é«˜è·¯è¿œï¼Œå†æ— æ—©ä¼šå‘¨æŠ¥ã€‚";
                return;
            }
            if (days >= 30) { av.innerText = "ğŸ—¿"; st.innerText = "çŠ¶æ€ï¼šå·¥ä½åŒ–çŸ³"; }
            else if (days >= 7) { av.innerText = "ğŸ¤¡"; st.innerText = "çŠ¶æ€ï¼šèµ„æ·±ç‰›é©¬"; }
            else if (days >= 1) { av.innerText = "ğŸ§Ÿ"; st.innerText = "çŠ¶æ€ï¼šè¡Œå°¸èµ°è‚‰"; }
            else { av.innerText = "ğŸ˜"; st.innerText = "çŠ¶æ€ï¼šæ­£åœ¨è‹Ÿæ´»"; }
        }

        async function loadData() {
            const { data } = await _supabase.from('status_logs').select().eq('id', 1).single();
            if (data) {
                days = data.days_count;
                quit = data.is_quit;
            }
            updateUI();
            btn.disabled = false;
            btn.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        async function checkIn() {
            if(quit) return;
            days++;
            
            // æ˜¾ç¤ºéšæœºé¸¡æ±¤
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            quoteEl.innerText = randomQuote;
            quoteEl.classList.remove('animate-pop');
            void quoteEl.offsetWidth; // è§¦å‘åŠ¨ç”»é‡ç»˜
            quoteEl.classList.add('animate-pop');

            updateUI();
            await _supabase.from('status_logs').update({ days_count: days }).eq('id', 1);
        }

        async function freedom() {
            if(confirm('çœŸçš„å†³å®šè§£è„±äº†å—ï¼Ÿ')) {
                quit = true;
                updateUI();
                await _supabase.from('status_logs').update({ is_quit: true }).eq('id', 1);
            }
        }

        loadData();
    </script>
</body>
</html>
